# 3 Dec 2023

| Previous journal: | Next journal: |
|-|-|
| [**0181**-2023-12-02.md](./0181-2023-12-02.md) | *Next journal TBA* |

# GFMPW-1: Trying to fix UPW harden for gf180-rbz-fsm

*   Looked at Tholin's and ReJ's projects and they just use the generic SDC file; no changes at all.
*   Some of their designs have clock periods on the order of 6ns! Tholin's SID is 166.6ns (6MHz), tho.
*   `make user_project_wrapper` on this repo yields only fanout errors.
*   Added shortcut:
    ```bash
    # Shortcut for summary.py.
    # Usage: olsum SUMMARY_TYPE [DESIGN [EXTRA_ARGS]]
    # SUMMARY_TYPE is e.g. full-summary.
    # DESIGN defaults to user_project_wrapper.
    # EXTRA_ARGS is appended if supplied after DESIGN.
    function olsum() {
        stype=$1; shift
        design=${1:-user_project_wrapper}; shift
        echo summary.py --caravel --design "$design" --$stype $@
        summary.py --caravel --design "$design" --$stype $@
    }
    ```

# Test 1

*   I'm doing a test without and with the generic SDC file. This is what I did:
    *   Used 25ns CLOCK_PERIOD in UPW.
    *   Kept 
    *   Moved all old run data (Legion 5 laptop) to openlane/ARCHIVED
    *   Made top_ew_algofoogle (TEA) use wb_clk_i instead of `io_in[11]`.
    *   Loaded env: `env-gf180`
    *   Started `time make top_ew_algofoogle` using 3 configured cores.
*   Next I did this:
    *   Modify UPW config.json to use correct CLOCK_PORT for `wb_clk_i`.
    *   `make user_project_wrapper`
    *   Copy the symlinks of these runs and name them `test-1`, to refer back to this section.

Results for TEA:

*   Time: 12:25
*   GDS size: 26MB (26733240)
*   Details from `olsum full-summary top_ew_algofoogle --run`:
    *   CoreArea_um^2: 910,571.1552
    *   Util: 36.19%
    *   Antennas: 1 pin, 1 net: Worst is only 102% (see `reports/signoff/46-antenna_violators.rpt`).
*   `reports/signoff/37-sta-rcx_nom/multi_corner_sta.checks.rpt`:
    *   Fanout: 1452 vios, all either 6/4 or 8/4
    *   Fastest max: 5.19
    *   Fastest slew: 0
    *   Fastest cap: 0
    *   Slowest max: -20.42
    *   Slowest slew: 12 vios, worst 3.52/3.0
    *   Slowest cap: 0
    *   Typical max: 0.5
    *   Typical slew: 0
    *   Typical cap: 0

Results for UPW:

*   Time: 3:18
*   GDS size: 28MB (28422028)
*   Details from `olsum full-summary user_project_wrapper --run`:
    *   WNS: -9.79
    *   TNS: -239.29
    *   CoreArea_um^2: 8,724,457.9968 (always expected to be the same)
    *   Antennas: 30 pin, 30 net: Worst is 352%. 5 exceed 210% (see `reports/signoff/30-antenna_violators.rpt`).
*   `reports/signoff/20-sta-rcx_nom/multi_corner_sta.checks.rpt`:
    *   Fastest max: 3.46
    *   **Fastest slew: 10, worst is 7.01/2.60**
    *   **Fastest cap: 5, worst is 0.66/0.23**
    *   Slowest max: -39.53
    *   Slowest slew: 43, worst is 17.99/3.0
    *   Slowest cap: 5, worst is 0.66/0.25
    *   **Typical max: -9.64**
    *   **Typical slew: 15, worst is 10.57/3.0**
    *   **Typical cap: 5, worst is 0.66/0.24**
*   `reports/signoff/20-sta-rcx_nom/multi_corner_sta.min.rpt` (HOLD):
    *   **Fastest min: -1.48 -- HOLD VIO**
    *   Slowest min: -2.12 -- HOLD VIO
    *   **Typical min: -1.66 -- HOLD VIO**

NOTE: I think we can ignore fanout in UPW because it is incorrectly using a fanout of 10 (instead of 4) and all fanouts should be from within the design macros anyway...?


# Test 2

*   Change number of cores on the VM to 8, and maybe 6 or 7 for routing.
*   Do exactly the same runs, but with generic SDC file now added in.
*   Compare results, esp:
    *   Does it change the GDS at all? Hopefully not. If it does, add 'antennas' to the checklists below.

Results for TEA:

*   NOTE: I've noticed there is a subtle difference between TEA test-1 and test-2. Same area and pin placement, and what LOOKS like basically the same cell placement, but slightly different routing.
*   Time: 13:46
*   GDS size: 26MB (26670610)
*   Details from `olsum full-summary top_ew_algofoogle --run`:
    *   CoreArea_um^2: 910,571.1552
    *   Util: 36.19%
    *   Antennas: 0
*   `reports/signoff/37-sta-rcx_nom/multi_corner_sta.checks.rpt`:
    *   **Fanout: 1608 vios, most ~8/4, but some up to 34/4 (on clkbufs)!**
    *   Fastest max: 15.35
    *   Fastest slew: 0
    *   Fastest cap: 0
    *   Slowest max: -20.83
    *   Slowest slew: 37 vios, worst 6.19/3.00
    *   Slowest cap: 0
    *   Typical max: 9.1
    *   **Typical slew: 17 vios, worst 3.44/3.00**
    *   Typical cap: 0

Results for UPW:

*   Time: 3:23
*   GDS size: 28MB (28368806)
*   Details from `olsum full-summary user_project_wrapper --run`:
    *   WNS: -9.9
    *   TNS: -242.06
    *   Antennas: 30 pin, 30 net: Worst is 353%. 5 exceed 210% (see `reports/signoff/30-antenna_violators.rpt`).
*   `reports/signoff/20-sta-rcx_nom/multi_corner_sta.checks.rpt`:
    *   Fastest max: 3.4
    *   Fastest slew: 10, worst is 6.66/2.60
    *   Fastest cap: 5, worst is 0.63/0.23
    *   Slowest max: -39.68
    *   Slowest slew: 33, worst is 17.11/3.0
    *   Slowest cap: 5, worst is 0.63/0.25
    *   **Typical max: -9.75 -- SETUP VIO**
    *   Typical slew: 13, worst is 10.05/3.0
    *   Typical cap: 5, worst is 0.63/0.24
*   `reports/signoff/20-sta-rcx_nom/multi_corner_sta.min.rpt` (HOLD):
    *   **Fastest min: -1.51 -- HOLD VIO**
    *   **Slowest min: -2.13 -- HOLD VIO**
    *   **Typical min: -1.69 -- HOLD VIO**


# Test 3

*   FSM wrapper for SHMUL
*   Try 40ns CLOCK_PERIOD for TEA
*   Test on FPGA too

# Test 4

*   Better assignment of IOs and LAs

# Test 5

*   Try reducing density


# Next steps

*   Update README to include instructions for hardening, inc. env vars.
