# 5 Sep 2023

| Previous journal: | Next journal: |
|-|-|
| [**0142**-2023-09-04.md](./0142-2023-09-04.md) | *Next journal TBA* |

# raybox-zero

## New tests

### test009-3: restrict pov output bits to typical minimum (Q7.9 and Q2.9)

<details><summary>Click for details...</summary>

Code:
*   tt04-raybox-zero: [`aec8784`](https://github.com/algofoogle/tt04-raybox-zero/commit/aec8784?diff=split): harden_test: Dry drun, ROUTING_CORES options
    *   Equivalent to: [`93dd1cd`](https://github.com/algofoogle/tt04-raybox-zero/commit/93dd1cd?diff=split): config.tcl default of 25MHz, using raybox-zero merged test005-shmul branch.
*   src/raybox-zero: [`b04ac58`](https://github.com/algofoogle/raybox-zero/commit/b04ac58?diff=split): (test009) pov output is now Q7.9 for player, Q2.9 for facing and vplane

Summary:
*   Go from SQ9.9 for everything to playerX/Y using SQ7.9 and facing/vplane using SQ2.9

Options used:
```
  STARTED: 2023-09-04 23:46:06
    SIZES: 4x2 8x2 (sorted: 4x2 8x2)
   COMBOS: 5 4 1 2 3 (sorted: 1 2 3 4 5)
    STOPT: 0
  OUTFILE: stats-test009-3.md
   SELECT: :[1245]
    FORCE: 1
      TAG: test009-3: restrict pov output bits to typical minimum (Q7.9 and Q2.9)
   RCORES: 14
      DRY: 0
 FINISHED: 2023-09-05 00:28:20
```

</details>

| | 4x2:1 | 8x2:1 | 4x2:2 | 8x2:2 | 4x2:3 | 8x2:3 | 4x2:4 | 8x2:4 | 4x2:5 | 8x2:5 |
|-|-:|-:|-:|-:|-:|-:|-:|-:|-:|-:|
| suggested_mhz | 25.00 | 25.00 | 50.00 | 50.00 | 0.00 | 0.00 | 48.71 | 48.52 | 25.00 | 25.00 |
| utilisation_% | 48.45 | 24.05 | 48.45 | 24.05 | 0.00 | 0.00 | 41.40 | 20.55 | 41.35 | 20.52 |
| wire_length_um | 200,721 | 200,479 | 203,397 | 202,421 | 0 | 0 | 146,345 | 149,706 | 140,652 | 143,309 |
| TotalCells | 20,290 | 35,189 | 20,275 | 35,325 | 0 | 0 | 19,930 | 34,932 | 19,747 | 34,762 |
| cells_pre_abc | 11,838 | 11,838 | 11,838 | 11,838 | 0 | 0 | 11,838 | 11,838 | 11,838 | 11,838 |
| synth_cells | 7,042 | 7,042 | 7,042 | 7,042 | 0 | 0 | 6,242 | 6,242 | 6,242 | 6,242 |
| logic_cells | 7,469 | 7,472 | 7,588 | 7,578 | 0 | 0 | 6,721 | 6,728 | 6,674 | 6,687 |
| pin_antennas | 3 | 2 | 3 | 4 | 0 | 0 | 2 | 3 | 3 | 2 |
| net_antennas | 3 | 2 | 3 | 4 | 0 | 0 | 2 | 3 | 3 | 2 |
| spef_wns | 0.00 | 0.00 | 0.00 | 0.00 | 0.00 | 0.00 | -0.53 | -0.61 | 0.00 | 0.00 |
| spef_tns | 0.00 | 0.00 | 0.00 | 0.00 | 0.00 | 0.00 | -18.35 | -25.46 | 0.00 | 0.00 |

Findings:
*   **TBC**




## Accomplishments

*   Reduced the range/resolution of outputs from `pov`. The module still outputs 24-bit values, but synth optimisation can benefit from the following:
    *   SPI vector update only needs 74 bits now instead of 144, so the buffers/registers are smaller.
    *   playerX/Y uses UQ6.9 (15b/ea) to cover `[0,63]` range with 1/512 resolution (which 'feels' like 3.5~5mm minimum step size).
    *   This reduces 
    *   Sim updated to suit.
*   In sim, CTRL+up/down will increase/decrease 'facing' vector scaling, in the range (0.01,1.99). This narrows/widens FOV.
*   In sim, CTRL+right/left increases/decreases 'vplane' vector scaling, in the range (0.01,1.99). This widens/narrows apparent aspect ratio.

## Next steps

*   Add in data from test009-1, 2, and 3.
*   See if there is some cheap effect we can do with wall/ceiling.
*   Try running on FPGA at a slower (or faster) clock.

## Later

*   Reduce *overall* fixed-point range to SQ9.9 maximum?

## Planning TT04 submission/completion

*   Doco
*   Look for `@@@`, `SMELL`s, `TODO`s, etc.
*   Test on FPGA
*   Configurability (e.g. VGA timing alts)
