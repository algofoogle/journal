# 6 Oct 2023

| Previous journal: | Next journal: |
|-|-|
| [**0152**-2023-10-04.md](./0152-2023-10-04.md) | *Next journal TBA* |

# SPI flash ROM FPGA tests

*   Before I write and run cocotb tests, I'll just wire up the chip with [my design](https://github.com/algofoogle/sandpit/blob/8f495c7b3c894136a5699201dfe2768252c784a7/fpga/vga_spi_rom/src/rtl/vga_spi_rom.v) and see how it goes. I'm not too worried about corrupting/damaging the chip because (a) I've physically strapped /WP (Write Protect); and (b) the design currently only sends 1 or 2 adjacent high bits, and these don't map to commands that might enable Dual or Quad outputs that would otherwise lead to a short.
    *   However, there is a risk that maybe /WP (hardware write protection) can be overridden:
        *   06h (2 adjacent bits) is command WREN (Write Enable)
        *   Apparently after this is sent it's possible to do 01h (1 trailing bit) which is WSR (Write Status Register)
        *   This could write 00 into (SRP1,SRP0), and apparently that switches to software protection, which could ignore /WP
    *   It seems unlikely to me, however, that we'd get a 01h after 06h, because that would mean they must be on different alignments.
    *   A possible mitigation might be to find an alternating bit stream (even 01010101) for our dummy read outputs that can't lead to anything meaningful.
    *   Confusingly, it seems that (SRP1,SRP0)=00 is the *default* state, i.e. software protection only?
*   Note [wiring of the vga_spi_rom design's SPI signals to the DE0-Nano](https://github.com/algofoogle/sandpit/blob/8f495c7b3c894136a5699201dfe2768252c784a7/fpga/vga_spi_rom/de0nano/top.v#L131-L135):
    ![vga_spi_rom wiring diagram of DE0-Nano pins to SPI chip signals](./i/0153-vga_spi_rom_wiring.svg)
