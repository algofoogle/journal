# 11 Nov 2025

| Previous journal: | Next journal: |
|-|-|
| [**0233**-2025-09-28.md](./0233-2025-09-28.md) | *Next journal TBA* |

# ttsky25b-vga-matrix-dac (revisited)

On the TTSKY25b shuttle I submitted a revision of my previous ttsky25**a**-vga-matrix-dac project (see [0233](./0233-2025-09-28.md)), and this is a quick note about that (written retrospectively).

For a lot more detail on the revision, ttsky25**b**-vga-matrix-dac, see [the project page on the TT website](https://tinytapeout.com/chips/ttsky25b/tt_um_algofoogle_vga_matrix_dac).

The short version of the story with this:

*   Layout extraction and simulation of the original ttsky25a version indicated a possible glitch issue, evidently because of capacitive coupling between the column-select lines and the critical Vbias line.
*   Additionally, the impedance of the Vbias line seemed to be on the high side, meaning this capacitive coupling would have a potentially stronger effect.
*   In the new version, I employed much better shielding techniques and a stronger Vbias source. Testing the SPICE capacitor sizes after Magic extraction of various layout adjustments helped me find optimal layouts.
*   I also included an option to register the digital outputs from the control block to the inputs of the DACs, aiming to avoid unsynchronised or glitchy switching of the row/column select lines.
*   All together, the simulation of this version thus looked substantially better -- even ideal -- for my intended specs.

Other points of note, not yet documented in detail:

*   To help rapidly hone in on on the glitching issue and test different solutions, I had to develop a simplified model for simulating it (as the layout-extracted SPICE file was much too complex and hence slow to simulate). This led me to inserting a model of parasitic capacitors in the original schematic, and then finding a way to configure them to only show up in simulation (and not in LVS files) -- they ended up giving a reasonably good approximation of the effect seen in the full layout, and were able to be simulated many times faster, while permitting a single schematic that could be used *both* for this simulation and for creating/validating the layout.
*   Discussion with Sylvain also revealed (around 2025-10-14) an MR violation in the ttsky25**a** version that wasn't caught by the open-source tools. It was due to "`hvi straddling diffusion`" where I had HVI over tap, but as a Magic-generated layer that was extending too far (and thus overlapping a diffusion region). I thought this HVI coverate for the tap was required when dealing with the higher-voltage transistors in my icell current sinks, but since this tap is already biasing the body at 0V it is assumed by all (inc. Tim Edwards) to be OK to just be LV (and the counterpoint is that the other neighbouring "digital logic" transistors are also LV anyway).

