# 14 Jul 2020

Commits on [`t08f`](https://github.com/algofoogle/sandpit/tree/master/fpga/XC9572XL/test08/t08f) aim to show progression from a primitive VGA generator, to game logic, to optimisation.

Commits so far are:
*   [`2020c1c`](https://github.com/algofoogle/sandpit/commit/2020c1c006569bd50a9d5dab6c39b47a903485aa#diff-7f31f702ff5b3e3115d011249617891e): "Green fill generator". Fills the screen with green, using VGA timing pretty close to what it should be for 640x480, from a 50MHz clock.
*   [`aee5565`](https://github.com/algofoogle/sandpit/commit/aee55651b1d3f10779de3be8c214e40fdf970121#diff-7f31f702ff5b3e3115d011249617891e): "Now using parameters; output core is the same". Does the same as above, but with magic numbers converted to useful `parameter`s. Produces exactly the same `.xsvf` file.
*   [`e365df3`](https://github.com/algofoogle/sandpit/commit/e365df3c4c6eba575bad01b71e64b608d33a9780#diff-7f31f702ff5b3e3115d011249617891e): "Added T, R, B walls". Instead of solid green fill, draws solid "walls" at top, right, and bottom. Not left, because that's where we'll put the paddle.
*   [`14c3f1f`](https://github.com/algofoogle/sandpit/commit/14c3f1f5ae330319d38be01822e13b470e34bb3d#diff-7f31f702ff5b3e3115d011249617891e): "Basic paddle motion". Now we render the paddle on the left, and it can be moved up and down with pushbuttons. Motion is slow (i.e. too fine), and paddle is half the width of what I had planned (because I forgot I'm using a 50MHz pixel clock instead of 25MHz).
*   [`15f06ea`](https://github.com/algofoogle/sandpit/commit/15f06eaf09867c8a2e22f3b6789ed7a6e1df8bda#diff-7f31f702ff5b3e3115d011249617891e): "Fix paddle width, double its speed, and give it an initial value". Paddle is now 32 pixels wide (same as walls), moves twice as fast in response to buttons, and we're using an `initial` block to set an initial value for the paddle position (i.e. setting it to 32, so it doesn't start embedded in the wall). The `initial` block *can* be synthesized for this particular CPLD.
*   [`386b79d`](https://github.com/algofoogle/sandpit/commit/386b79d709ce52fed98f41a9877fc53056d947d4#diff-7f31f702ff5b3e3115d011249617891e): "Added a ball, but it doesn't move yet". Ball (with `initial` position X=35, Y=50) is 16x16 pixels.
*   [`d4b5076`](https://github.com/algofoogle/sandpit/commit/d4b5076d4176358333605f9fcf1c3f6b24c3db80#diff-7f31f702ff5b3e3115d011249617891e): "Trying to add ball motion but design doesn't fit now". Simple increment of `ballX` and `ballY` at the end of each frame, trying to make it move, but the design doesn't fit. Even if it did, I forgot that `ballX` needs to be incremented by 2 each frame, instead of 1, due to 50MHz clock. I changed multiple parameters for the synthesis and fitter, and kept these in the project, but to no avail.
*   [`b1a1dd7`](https://github.com/algofoogle/sandpit/commit/b1a1dd7fd078d3a3ac57c92b6418447d1d02dd7b#diff-7f31f702ff5b3e3115d011249617891e): "Speed up the ball and hence use less-precise tests to get a fit". Some simple optimisation: each frame, the ball moves by 2px on both X and Y, so we can get away with counters with 1 bit fewer, which in turn means comparators can be shorter, hence allowing the design to fit. Since everything is being compared now with effectively double-sized pixels, the ball width and height are adjusted to `8`, which still equates to 16x16 pixels. The ball moves, but drifts off screen, wraps around, creates some artefacts...
*   [`01fe8e2`](https://github.com/algofoogle/sandpit/commit/01fe8e2530933a41dd6b59cf50cf903786c75734#diff-7f31f702ff5b3e3115d011249617891e): "Ball now bounces around. Doesn't yet interact with paddle". Ball X and Y direction flags now define whether each axis increments or decrements per frame, and those flags update when the ball has intersected with any of the walls. At the moment, the paddle is ignored: The left-hand edge of the screen is treated as a full wall.

I made a script, [`f.sh`](https://github.com/algofoogle/sandpit/blob/master/fpga/XC9572XL/f.sh), which can be used to try a "breadth first" search for a fitting solution. By default, it will try using 54 inputs for each of the 90..1 pterms combinations with `cpldfit`. If it finds a fit, it will build the `.jed` file.

